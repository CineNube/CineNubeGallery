<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CatÃ¡logo - CineNube Gallery</title>
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;background:#0e0e0e;color:#fff;margin:0;padding:0;overflow-x:hidden}
  header{background:#1c1c1c;padding:20px;text-align:center;font-size:26px;font-weight:bold;color:#ff4444;box-shadow:0 0 10px rgba(0,0,0,0.5)}
  nav{display:flex;justify-content:center;gap:20px;background:#141414;padding:12px 0;font-weight:bold;flex-wrap:wrap}
  nav button{background:none;border:none;color:#fff;cursor:pointer;font-size:16px;transition:color .3s}
  nav button:hover{color:#ff4444}
  #search{width:90%;max-width:400px;margin:10px auto 0;display:block;padding:8px;border-radius:8px;border:none;font-size:16px}
  #gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;padding:20px}
  .item{background:#1a1a1a;border-radius:12px;overflow:hidden;text-align:center;box-shadow:0 0 10px rgba(0,0,0,0.5);transition:transform .25s,box-shadow .25s;position:relative}
  .item:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(255,68,68,.6)}
  .item img{width:100%;height:320px;object-fit:cover;border-bottom:3px solid #ff4444}
  @media(max-width:768px){.item img{height:260px}}
  .tag{position:absolute;top:10px;left:10px;background:#ff4444;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:bold}
  .item h3{font-size:17px;margin:10px 0 5px;color:#ff4444}
  .item p{font-size:13px;color:#ccc;padding:0 10px;text-align:justify;height:60px;overflow:hidden}
  .hashtags{font-size:12px;color:#ff66aa;margin:5px 0 10px;padding:0 10px;height:36px;overflow:hidden}
  .btn{display:block;background:#ff4444;color:#fff;text-decoration:none;padding:10px;border-radius:0 0 12px 12px;font-weight:bold;transition:background .3s}
  .btn:hover{background:#cc0000}
</style>
</head>
<body>
<header>ðŸ“š CatÃ¡logo - CineNube Gallery</header>
<nav>
  <button onclick="filterContent('all')">ðŸ”¥ Todo</button>
  <button onclick="filterContent('pelicula')">ðŸŽ¥ PelÃ­culas</button>
  <button onclick="filterContent('serie')">ðŸ“º Series</button>
</nav>
<input type="text" id="search" placeholder="ðŸ” Buscar pelÃ­culas o series..." oninput="searchGallery(this.value)">
<div id="gallery"></div>
<script>
const SHEET_URL='https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';
let allData=[];

async function loadGallery(){
 try{
  const res=await fetch(SHEET_URL);
  const data=await res.json();
  allData=data.sort((a,b)=>new Date(b.published_at)-new Date(a.published_at));
  renderGallery(allData);
 }catch(e){
  document.getElementById('gallery').innerHTML='<p style="text-align:center;color:#ccc;">Error cargando datos</p>';
 }
}

function renderGallery(items){
 const g=document.getElementById('gallery');g.innerHTML='';
 items.forEach(item=>{
  const tipo=(item.tipo||'pelicula').toLowerCase();
  const tipoTexto=tipo==='serie'?'ðŸ“º Serie':'ðŸŽ¥ PelÃ­cula';
  const btnText=tipo==='serie'?'ðŸ“º Ver temporada':'ðŸŽ¥ Ver pelÃ­cula';
  let link='#';
  if(item.terabox&&item.terabox.includes('http')) link=item.terabox;
  else if(item.season_links){try{const s=JSON.parse(item.season_links);link=s[0]?.link||'#';}catch{}}
  let hashtags='';
  if(item.generos){const gArr=item.generos.split(',').map(g=>g.trim());hashtags=gArr.map(g=>'#'+g.replace(/\s+/g,'')).join(' ');}
  const div=document.createElement('div');
  div.className='item';
  div.dataset.tipo=tipo;
  div.dataset.titulo=(item.titulo||'').toLowerCase();
  div.dataset.descripcion=(item.descripcion||'').toLowerCase();
  div.innerHTML=`
   <span class="tag">${tipoTexto}</span>
   <img src="${item.imagen}" loading="lazy" alt="${item.titulo}">
   <h3>${item.titulo}</h3>
   <p>${item.descripcion||''}</p>
   <div class="hashtags">${hashtags}</div>
   <a href="${link}" target="_blank" class="btn">${btnText}</a>`;
  g.appendChild(div);
 });
}

function filterContent(t){
 if(t==='all'){renderGallery(allData);}
 else{renderGallery(allData.filter(x=>(x.tipo||'').toLowerCase()===t));}
}

function normalize(str){return str.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase();}

function searchGallery(query){
 const q=normalize(query);
 const filtered=allData.filter(item=>{
   const titulo=normalize(item.titulo||'');
   const desc=normalize(item.descripcion||'');
   return titulo.includes(q) || desc.includes(q);
 });
 renderGallery(filtered);
}

loadGallery();
</script>
</body>
</html>
