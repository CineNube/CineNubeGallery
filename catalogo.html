<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cat치logo | CineNube</title>
<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; background:#0e0e0e; color:#fff; margin:0; }
  header { background:#1c1c1c; padding:15px; text-align:center; font-size:24px; color:#00aaff; font-weight:bold; }
  #catalog { display:grid; gap:15px; grid-template-columns:repeat(auto-fill, minmax(200px,1fr)); padding:20px; }
  .item { background:#1a1a1a; border-radius:10px; overflow:hidden; text-align:center; transition:transform 0.2s; display:flex;flex-direction:column;height:420px; }
  .item:hover { transform:scale(1.05); }
  .item img { width:100%; height:260px; object-fit:cover; display:block; border-bottom:3px solid #00aaff }
  .item .content { padding:10px; display:flex; flex-direction:column; flex:1; }
  .item h3 { margin:0 0 6px 0; font-size:17px; color:#00aaff; }
  .item p { font-size:14px; color:#ccc; flex:1; margin:0 0 8px 0; overflow:hidden; }
  .item a { display:inline-block; background:#00aaff; padding:8px 10px; color:white; text-decoration:none; border-radius:8px; font-weight:700; }
  .item .meta { color:#9aaebf; font-size:13px; margin-bottom:8px; }
  .empty{padding:40px;text-align:center;color:#aaa}
</style>
</head>
<body>
  <header>Cat치logo CineNube</header>
  <div id="catalog"></div>

  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycby4xMzVNgE7ZWLx69T6FmqB3_58Qc60lsGS1eC0D9QU/dev';

    function safeParseJSON(s){ try{return JSON.parse(s);}catch(e){return null;} }
    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function normalizeLink(raw){
      if(!raw) return '#';
      const s=String(raw).trim();
      if(s.startsWith('http://') || s.startsWith('https://')) return s;
      if(s === '#') return '#';
      return '#';
    }

    function getPrimaryLink(it){
      if(it.terabox){
        try{ const p = safeParseJSON(it.terabox); if(Array.isArray(p) && p[0] && p[0].link) return p[0].link; }catch(e){}
        const m = (it.terabox||'').match(/https?:\/\/[^\s"']+/);
        if(m) return m[0];
        if(String(it.terabox).trim()) return String(it.terabox).trim();
      }
      return '#';
    }

    async function loadCatalog() {
      try {
        const res = await fetch(SHEET_URL);
        const data = await res.json();
        if(!Array.isArray(data)){ document.getElementById('catalog').innerHTML = '<div class="empty">Respuesta inv치lida del WebApp.</div>'; return; }

        renderCatalog(data);
      } catch(e){
        console.error(e);
        document.getElementById('catalog').innerHTML = '<div class="empty">Error cargando el cat치logo</div>';
      }
    }

    function renderCatalog(list){
      const catalog = document.getElementById('catalog');
      catalog.innerHTML = '';
      if(!list || list.length === 0){ catalog.innerHTML = '<div class="empty">No hay resultados</div>'; return; }

      list.forEach(it=>{
        const title = it.title;
        const poster = it.poster;
        const posterUrl = (poster && poster.indexOf('http') === 0) ? poster : '';
        const href = normalizeLink(getPrimaryLink(it));

        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div class="thumb"><img src="${encodeURI(posterUrl || 'https://via.placeholder.com/500x750?text=Sin+imagen')}" alt="${escapeHtml(title)}"></div>
          <div class="content">
            <h3>${escapeHtml(title)}</h3>
            <p>${escapeHtml(it.overview||'')}</p>
            <div class="meta">${it.year||''}</div>
            <a href="${href}" target="_blank">游꿟 Ver</a>
          </div>
        `;
        catalog.appendChild(div);
      });
    }

    loadCatalog();
  </script>
</body>
</html>
