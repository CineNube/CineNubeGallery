<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cat√°logo | CineNube</title>
<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; background:#0e0e0e; color:#fff; margin:0; }
  header { background:#1c1c1c; padding:15px; text-align:center; font-size:24px; color:#00aaff; font-weight:bold; }
  #catalog { display:grid; gap:15px; grid-template-columns:repeat(auto-fill, minmax(200px,1fr)); padding:20px; }
  .item { background:#1a1a1a; border-radius:10px; overflow:hidden; text-align:center; transition:transform 0.2s; display:flex;flex-direction:column;height:440px; }
  .item:hover { transform:scale(1.05); }
  .item img { width:100%; height:260px; object-fit:cover; display:block; border-bottom:3px solid #00aaff }
  .item .content { padding:10px; display:flex; flex-direction:column; flex:1; }
  .item h3 { margin:0 0 6px 0; font-size:17px; color:#00aaff; }
  .item p { font-size:14px; color:#ccc; flex:1; margin:0 0 8px 0; overflow:hidden; }
  .item a { display:inline-block; background:#00aaff; padding:8px 10px; color:white; text-decoration:none; border-radius:8px; font-weight:700; margin: 3px 0; }
  .item .meta { color:#9aaebf; font-size:13px; margin-bottom:8px; }
  .empty{padding:40px;text-align:center;color:#aaa}
</style>
</head>
<body>
  <header>Cat√°logo CineNube</header>
  <div id="catalog"></div>

  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';

    function safeJSON(s){
      try{ return JSON.parse(s); }catch{ return null; }
    }

    function getBestDate(it){
      return Date.parse(it.published_at || it.updated || it.updated_at || "") || 0;
    }

    async function loadCatalog(){
      const res = await fetch(SHEET_URL);
      const data = await res.json();

      data.sort((a,b)=>getBestDate(b)-getBestDate(a));
      render(data);
    }

    function render(list){
      const el = document.getElementById("catalog");
      el.innerHTML="";

      list.forEach(it=>{
        const title = it.title || it.titulo || "Sin t√≠tulo";
        const poster = it.poster || it.imagen || "";
        const posterUrl = poster.startsWith("http") ? poster : (poster ? "https://image.tmdb.org/t/p/w500"+poster : "");

        const rating = it.rating ? "‚≠ê "+it.rating : "‚≠ê N/A";
        const year = it.year ? " ‚Ä¢ "+it.year : "";

        let actions = "";

        // ‚úÖ Pel√≠culas con terabox
        if(it.terabox){
          const m = String(it.terabox).match(/https?:\/\/[^\s"']+/);
          if(m){
            actions += `<a href="${m[0]}" target="_blank">üé¨ Ver pel√≠cula</a>`;
          }
        }

        // ‚úÖ Series ‚Äî listar temporadas
        if(it.season_links){
          const seasons = safeJSON(it.season_links);
          if(Array.isArray(seasons)){
            seasons.forEach(s=>{
              if(s.link){
                actions += `<a href="${s.link}" target="_blank">üì∫ T${s.season}</a>`;
              }
            });
          }
        }

        const div = document.createElement("div");
        div.className="item";
        div.innerHTML = `
          <img src="${posterUrl}" alt="${title}">
          <div class="content">
            <h3>${title}</h3>
            <p class="meta">${rating}${year}</p>
            <p>${it.overview || it.descripcion || ""}</p>
            ${actions}
          </div>
        `;
        el.appendChild(div);
      });
    }

    loadCatalog();
  </script>
</body>
</html>
