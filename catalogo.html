<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cat√°logo | CineNube</title>
<style>
body{font-family:'Segoe UI',Arial,sans-serif;background:#0e0e0e;color:#fff;margin:0}
header{background:#1c1c1c;padding:15px;text-align:center;font-size:24px;color:#00aaff;font-weight:bold}
#catalog{display:grid;gap:15px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));padding:20px}
.item{background:#1a1a1a;border-radius:10px;overflow:hidden;text-align:center;transition:transform 0.2s;display:flex;flex-direction:column}
.item:hover{transform:scale(1.05)}
.item img{width:100%;height:260px;object-fit:cover;display:block;border-bottom:3px solid #00aaff}
.item .content{padding:10px;display:flex;flex-direction:column;flex:1}
.item h3{margin:0 0 6px 0;font-size:17px;color:#00aaff}
.item p{font-size:14px;color:#ccc;flex:1;margin:0 0 8px 0;overflow:hidden}
.item a{display:inline-block;background:#00aaff;padding:8px 10px;color:white;text-decoration:none;border-radius:8px;font-weight:700}
.meta{color:#9aaebf;font-size:13px;margin-bottom:8px}
.social-share{display:flex;justify-content:center;gap:8px;margin-top:8px}
.social-btn{border:none;background:#222;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.2s}
.social-btn:hover{background:#00aaff}
.social-btn img{width:18px;height:18px}
</style>
</head>
<body>
<header>Cat√°logo CineNube</header>
<div id="catalog"></div>

<script>
const SHEET_URL='https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';
function safeParseJSON(s){try{return JSON.parse(s);}catch{return null;}}
function escapeHtml(s){return s?String(s).replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])):'';}
function normalizeLink(r){if(!r)return'#';const s=String(r).trim();if(s.startsWith('http'))return s;return'https://cinenube.github.io/CineNubeGallery/'+s.replace(/^\/+/,'');}
async function loadCatalog(){
 const res=await fetch(SHEET_URL);const data=await res.json();
 const list=data.map(x=>({title:x.title||x.titulo||x.name||'',poster:x.poster||x.imagen||'',overview:x.overview||x.descripcion||'',rating:x.rating||'',year:x.year||'',terabox:x.terabox||'',season_links:x.season_links||''}));
 render(list);
}
function getPrimaryLink(it){
 if(it.terabox){try{const p=safeParseJSON(it.terabox);if(Array.isArray(p)&&p[0]&&p[0].link)return p[0].link;}catch{}const m=(it.terabox||'').match(/https?:\/\/[^\s"']+/);if(m)return m[0];}
 if(it.season_links){try{const s=safeParseJSON(it.season_links);if(Array.isArray(s)&&s[0]&&s[0].link)return s[0].link;}catch{}}
 return '#';
}
function shareContent(p,t,u){
 const text=`üé¨ ${t}\nM√≠ralo aqu√≠ üëâ ${u}`;
 if(p==='whatsapp')window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,'_blank');
 if(p==='x')window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(text)}`,'_blank');
 if(p==='facebook')window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(u)}&quote=${encodeURIComponent(t)}`,'_blank');
 if(p==='copy'){navigator.clipboard.writeText(text);alert('üìã Enlace copiado');}
}
function render(list){
 const c=document.getElementById('catalog');c.innerHTML='';
 list.forEach(it=>{
   const poster=(it.poster.startsWith('http')?it.poster:'https://image.tmdb.org/t/p/w500'+it.poster);
   const link=normalizeLink(getPrimaryLink(it));
   const div=document.createElement('div');
   div.className='item';
   div.innerHTML=`
     <img src="${poster}" alt="${escapeHtml(it.title)}">
     <div class="content">
       <h3>${escapeHtml(it.title)}</h3>
       <div class="meta">${it.rating?'‚≠ê '+it.rating:''} ${it.year?'‚Ä¢ '+it.year:''}</div>
       <p>${escapeHtml(it.overview).slice(0,100)}...</p>
       <a href="${link}" target="_blank">Ver</a>
       <div class="social-share">
         <button class="social-btn" onclick="shareContent('whatsapp','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg"></button>
         <button class="social-btn" onclick="shareContent('x','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg"></button>
         <button class="social-btn" onclick="shareContent('facebook','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg"></button>
         <button class="social-btn" onclick="shareContent('copy','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/link.svg"></button>
       </div>
     </div>`;
   c.appendChild(div);
 });
}
loadCatalog();
</script>
</body>
</html>
