<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CineNube Gallery</title>
  <style>
    body {background:#0c0c0c;color:#fff;font-family:Arial;margin:0}
    header{background:#111;padding:10px;text-align:center;font-size:1.5em}
    nav{display:flex;justify-content:center;background:#222;flex-wrap:wrap}
    nav button{background:none;border:none;color:white;padding:12px 18px;cursor:pointer;font-size:1em}
    nav button.active{border-bottom:2px solid #ff9800}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;padding:15px}
    .card{background:#1c1c1c;border-radius:8px;overflow:hidden;transition:.2s}
    .card:hover{transform:scale(1.03)}
    .poster{width:100%;height:240px;object-fit:cover}
    .info{padding:10px}
    .title{font-weight:bold;font-size:1em;margin-bottom:5px}
    .meta{font-size:.85em;color:#bbb}
    a{color:#ff9800;text-decoration:none}
    #debug{background:#111;color:#0f0;padding:10px;font-size:12px;max-height:200px;overflow:auto;margin:10px;border-radius:8px}
  </style>
</head>
<body>
  <header>ğŸ¬ CineNube Gallery</header>
  <nav>
    <button class="tab active" data-type="recientes">ğŸ”¥ Recientes (24h)</button>
    <button class="tab" data-type="movie">ğŸ¥ PelÃ­culas</button>
    <button class="tab" data-type="series">ğŸ“º Series</button>
    <button class="tab" data-type="todos">ğŸ” Todos</button>
  </nav>
  <div id="content" class="grid"></div>
  <pre id="debug"></pre>

  <script>
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec";
    let allData = [];

    async function loadData() {
      try {
        const res = await fetch(SHEET_URL);
        const raw = await res.json();
        const data = Array.isArray(raw) ? raw : (raw.data || []);
        document.getElementById("debug").textContent = JSON.stringify(data[0], null, 2);
        allData = data;
        showData("recientes");
      } catch (err) {
        document.getElementById("debug").textContent = "Error: " + err;
      }
    }

    function showData(type) {
      const c = document.getElementById("content");
      c.innerHTML = "";
      const now = new Date();
      let filtered = [];

      if (type === "recientes") {
        filtered = allData.filter(item => {
          const date = new Date(item.published_at || item.Published_at || item.updated_at || item.updated);
          return (now - date) / (1000*60*60) <= 24;
        });
      } else if (type === "movie") filtered = allData.filter(i => String(i.type).toLowerCase()==="movie");
      else if (type === "series") filtered = allData.filter(i => String(i.type).toLowerCase()==="series");
      else filtered = allData;

      if (filtered.length===0){c.innerHTML="<p>No hay resultados</p>";return;}

      filtered.forEach(item=>{
        const card=document.createElement("div");
        card.className="card";
        const poster=item.poster||"https://via.placeholder.com/300x450?text=Sin+Imagen";
        const title=item.title||"Sin tÃ­tulo";
        const rating=item.rating||"N/A";
        const year=item.year?"ğŸ“… "+item.year:"";
        let link="#";
        if(String(item.type).toLowerCase()==="movie"&&item.terabox){
          try{const p=JSON.parse(item.terabox);if(p[0].link)link=p[0].link;}catch{link=item.terabox;}
        } else if(String(item.type).toLowerCase()==="series"&&item.season_links){
          try{const s=JSON.parse(item.season_links);if(s[0].link)link=s[0].link;}catch{}
        }
        card.innerHTML=`
          <img src="${poster}" alt="${title}" class="poster">
          <div class="info">
            <div class="title">${title}</div>
            <div class="meta">â­ï¸ ${rating} ${year}</div>
            <a href="${link}" target="_blank">Ver</a>
          </div>`;
        c.appendChild(card);
      });
    }

    document.querySelectorAll(".tab").forEach(btn=>{
      btn.addEventListener("click",()=>{
        document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        showData(btn.dataset.type);
      });
    });

    loadData();
  </script>
</body>
</html>
