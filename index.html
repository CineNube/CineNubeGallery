<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CineNube Gallery</title>
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;background:#0e0e0e;color:#fff;margin:0;padding:0;overflow-x:hidden}
  header{background:#1c1c1c;padding:20px;text-align:center;font-size:26px;font-weight:bold;color:#00aaff;box-shadow:0 0 10px rgba(0,0,0,0.5)}
  nav{display:flex;justify-content:center;gap:20px;background:#141414;padding:12px 0;font-weight:bold}
  nav button{background:none;border:none;color:#fff;cursor:pointer;font-size:16px;transition:color .3s}
  nav button:hover{color:#00aaff}
  #search{width:90%;margin:15px auto;display:block;padding:12px;border-radius:8px;border:none;font-size:16px;outline:none;background:#1c1c1c;color:#fff}
  #gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;padding:20px}
  .item{background:#1a1a1a;border-radius:12px;overflow:hidden;text-align:center;box-shadow:0 0 10px rgba(0,0,0,0.5);transition:transform .25s,box-shadow .25s;position:relative}
  .item:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(0,170,255,.6)}
  .item img{width:100%;height:320px;object-fit:cover;border-bottom:3px solid #00aaff}
  @media(max-width:768px){.item img{height:260px}}
  .tag{position:absolute;top:10px;left:10px;background:#00aaff;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:bold}
  .item h3{font-size:17px;margin:10px 0;color:#00aaff}
  .item p{font-size:13px;color:#ccc;padding:0 10px;text-align:justify;height:60px;overflow:hidden}
  .btn-holder{padding:10px;border-top:1px solid #00aaff}
  .btn{display:block;background:#00aaff;color:#fff;text-decoration:none;padding:8px;border-radius:8px;font-weight:bold;margin-top:6px}
  .btn:hover{background:#0077cc}
  .season-box{background:#111;border-top:1px solid #00aaff;padding:8px;display:none}
  .season-box a{display:block;background:#222;color:#fff;padding:6px;border-radius:6px;text-decoration:none;margin:4px 0;border-left:3px solid #00aaff;font-size:14px}
  .season-box a:hover{background:#333}
</style>
</head>
<body>
<header>ðŸŽ¬ CineNube Gallery</header>

<nav>
  <button onclick="filterContent('all')">ðŸ”¥ Todo</button>
  <button onclick="filterContent('pelicula')">ðŸŽ¥ PelÃ­culas</button>
  <button onclick="filterContent('serie')">ðŸ“º Series</button>
</nav>

<input type="text" id="search" placeholder="ðŸ” Buscar por tÃ­tulo, gÃ©nero o descripciÃ³n...">

<div id="gallery"></div>

<script>
const SHEET_URL='https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';
let allData=[];

async function loadGallery(){
  const res=await fetch(SHEET_URL);
  const data=await res.json();
  allData=data.sort((a,b)=>new Date(b.updated)-new Date(a.updated));
  renderGallery(allData);
}

function renderGallery(items){
  const g=document.getElementById('gallery');g.innerHTML='';
  items.forEach(item=>{
    const tipo=(item.tipo||'pelicula').toLowerCase();
    const card=document.createElement('div');card.className='item';

    let seasonsHTML="";
    if(tipo==='serie' && item.season_links){
      try{
        const sl=JSON.parse(item.season_links);
        seasonsHTML=`<div class="btn-holder"><button class="btn" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'">ðŸ“º Ver temporadas</button><div class="season-box">${sl.map(s=>`<a target="_blank" href="${s.link}">Temporada ${s.season}</a>`).join('')}</div></div>`;
      }catch{}
    }

    const btnMovie= tipo==='pelicula' ? `<div class="btn-holder"><a class="btn" href="${item.terabox}" target="_blank">ðŸŽ¥ Ver pelÃ­cula</a></div>` : '';

    card.innerHTML=`
      <span class="tag">${tipo==='serie'?'ðŸ“º Serie':'ðŸŽ¥ PelÃ­cula'}</span>
      <img src="${item.imagen}">
      <h3>${item.titulo}</h3>
      <p>${item.descripcion||''}</p>
      ${tipo==='serie'?seasonsHTML:btnMovie}
    `;
    g.appendChild(card);
  });
}

function filterContent(t){
  if(t==='all') renderGallery(allData);
  else renderGallery(allData.filter(x=>(x.tipo||'').toLowerCase()===t));
}

document.getElementById('search').addEventListener('input',e=>{
  const q=e.target.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
  renderGallery(allData.filter(x=>{
    return (x.titulo+x.generos+x.descripcion).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(q);
  }));
});

loadGallery();
</script>
</body>
</html>
