<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CineNube</title>

<style>
  body { margin:0; background:#0e0e0e; color:white; font-family: "Segoe UI", Arial; }
  header { padding:14px; text-align:center; font-size:24px; font-weight:bold; color:#00aaff; background:#1b1b1b; border-bottom:2px solid #00aaff; }

  /* Grid */
  .grid { display:grid; gap:14px; padding:18px; grid-template-columns:repeat(auto-fill, minmax(150px,1fr)); }
  .item { background:#1a1a1a; border-radius:12px; overflow:hidden; transition:transform .2s; display:flex; flex-direction:column; height:330px; }
  .item:hover { transform:scale(1.05); }
  .item img { width:100%; height:230px; object-fit:cover; border-bottom:3px solid #00aaff; }
  .info { padding:8px; flex:1; display:flex; flex-direction:column; }
  .info h3 { font-size:15px; margin:0 0 6px; color:#00aaff; }
  .meta { font-size:13px; color:#9aaebf; margin-bottom:6px; }
  .actions a { display:block; background:#00aaff; text-align:center; padding:6px; border-radius:6px; margin-top:4px; color:#fff; text-decoration:none; font-weight:600; }

  /* Search */
  #searchBox { margin:12px auto 0; width:92%; padding:10px; font-size:16px; border-radius:8px; border:none; outline:none; background:#1d1d1d; color:white; }

  /* Bottom nav */
  .nav { position:fixed; bottom:0; left:0; right:0; background:#111; border-top:2px solid #00aaff; display:flex; justify-content:space-around; padding:8px 0; }
  .nav a { color:#9fdcff; text-decoration:none; font-size:15px; font-weight:600; }
  .nav a.active { color:#00aaff; }

</style>
</head>
<body>

<header>CineNube</header>

<input type="text" id="searchBox" placeholder="üîç Buscar pel√≠cula o serie...">

<div id="content" class="grid"></div>

<!-- Bottom Menu -->
<div class="nav">
  <a href="#" data-filter="all" class="active">üè† Inicio</a>
  <a href="#" data-filter="movie">üé¨ Pel√≠culas</a>
  <a href="#" data-filter="series">üì∫ Series</a>
  <a href="catalogo.html">üóÇÔ∏è Cat√°logo</a>
</div>

<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';
let DATA = [];
let CURRENT_FILTER = "all";

function safeJSON(txt){ try{ return JSON.parse(txt); } catch{ return null; } }

function getDate(item){
  return Date.parse(item.published_at || item.updated || item.updated_at || "") || 0;
}

async function load(){
  const res = await fetch(SHEET_URL);
  DATA = await res.json();

  DATA.sort((a,b)=>getDate(b)-getDate(a)); // ‚úÖ Recientes reales
  render();
}

function render(){
  const grid = document.getElementById("content");
  grid.innerHTML = "";

  const q = document.getElementById("searchBox").value.toLowerCase();

  DATA
    .filter(item => CURRENT_FILTER==="all" || item.type === CURRENT_FILTER)
    .filter(item => (item.title || "").toLowerCase().includes(q))
    .forEach(it=>{
      const img = it.poster || it.imagen || "";
      const poster = img.startsWith("http") ? img : ("https://image.tmdb.org/t/p/w500" + img);
      const rating = it.rating ? "‚≠ê "+it.rating : "";
      const year = it.year ? " ‚Ä¢ "+it.year : "";

      let links = "";

      // Pel√≠cula
      if(it.terabox){
        const m = String(it.terabox).match(/https?:\/\/[^\s"']+/);
        if(m){ links += `<a href="${m[0]}" target="_blank">üé¨ Ver</a>`; }
      }

      // Serie (todas las temporadas)
      const seasons = safeJSON(it.season_links);
      if(Array.isArray(seasons)){
        seasons.forEach(s=>{
          if(s.link){
            links += `<a href="${s.link}" target="_blank">T${s.season}</a>`;
          }
        });
      }

      const div = document.createElement("div");
      div.className="item";
      div.innerHTML = `
        <img src="${poster}">
        <div class="info">
          <h3>${it.title}</h3>
          <div class="meta">${rating}${year}</div>
          <div class="actions">${links}</div>
        </div>
      `;
      grid.appendChild(div);
    });
}

document.getElementById("searchBox").oninput = render;

document.querySelectorAll(".nav a[data-filter]").forEach(a=>{
  a.onclick = ()=>{ 
    document.querySelectorAll(".nav a").forEach(n=>n.classList.remove("active"));
    a.classList.add("active");
    CURRENT_FILTER = a.dataset.filter;
    render();
  };
});

load();
</script>

</body>
</html>
