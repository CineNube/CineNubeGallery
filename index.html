<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>CineNube Gallery</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<style>
  body { background:#121212; color:#fff; font-family:sans-serif; margin:0; padding:0; }
  .header { padding:1rem; text-align:center; background:#1f1f1f; }
  .search-box { width:100%; max-width:500px; margin:1rem auto; }
  .tabs { display:flex; justify-content:center; gap:1rem; margin-bottom:1rem; }
  .tab { cursor:pointer; padding:0.5rem 1rem; background:#1f1f1f; border-radius:5px; }
  .tab.active { background:#ff3f3f; color:#fff; }
  .container { display:flex; flex-wrap:wrap; justify-content:center; gap:1rem; padding:1rem; }
  .card { background:#1f1f1f; border-radius:10px; width:200px; overflow:hidden; }
  .card img { width:100%; height:300px; object-fit:cover; }
  .card-body { padding:0.5rem; }
  .card-title { font-size:1rem; font-weight:bold; margin:0; }
  .card-text { font-size:0.8rem; color:#ccc; }
  .btn-season { display:block; margin-top:0.3rem; padding:0.2rem 0.4rem; background:#ff3f3f; color:#fff; text-align:center; border-radius:5px; text-decoration:none; font-size:0.75rem; }
</style>
</head>
<body>
<div class="header"><h2>CineNube Gallery</h2></div>
<div class="search-box"><input type="text" id="searchInput" class="form-control" placeholder="Buscar..."></div>
<div class="tabs">
  <div class="tab active" data-filter="all">Todo</div>
  <div class="tab" data-filter="movie">Pel√≠culas</div>
  <div class="tab" data-filter="series">Series</div>
</div>
<div class="container" id="content"></div>

<script>
const SHEET_JSON_URL = "https://script.google.com/macros/s/AKfycbx1Vq5HqmPMExtgm1PRgct2WRzGex5BTEtDERIKHA20VZNFf-umdHpiKD94Df80S2vO1g/exec";
let items = [];
const contentEl = document.getElementById('content');
const searchInput = document.getElementById('searchInput');

function truncateText(text, maxLength=120){
  return text.length > maxLength ? text.slice(0,maxLength) + '...' : text;
}

function renderItems(filter='all'){
  contentEl.innerHTML = '';
  let filtered = items.filter(i => filter==='all' || i.type===filter);
  filtered.forEach(i => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${i.poster}" alt="${i.title}">
      <div class="card-body">
        <div class="card-title">${i.title}</div>
        <div class="card-text">${truncateText(i.overview)}</div>
        ${i.type==='series' && i.season_links.length>0
          ? i.season_links.map(s=>`<a class="btn-season" href="${s.link}" target="_blank">Temporada ${s.season}</a>`).join('')
          : i.type==='movie' && i.terabox ? `<a class="btn-season" href="${i.terabox}" target="_blank">Ver ahora</a>` : ''}
      </div>`;
    contentEl.appendChild(card);
  });
}

function applySearch(){
  const q = searchInput.value.toLowerCase();
  const filtered = items.filter(i => i.title.toLowerCase().includes(q) || i.generos.toLowerCase().includes(q));
  contentEl.innerHTML = '';
  filtered.forEach(i=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <img src="${i.poster}" alt="${i.title}">
      <div class="card-body">
        <div class="card-title">${i.title}</div>
        <div class="card-text">${truncateText(i.overview)}</div>
        ${i.type==='series' && i.season_links.length>0
          ? i.season_links.map(s=>`<a class="btn-season" href="${s.link}" target="_blank">Temporada ${s.season}</a>`).join('')
          : i.type==='movie' && i.terabox ? `<a class="btn-season" href="${i.terabox}" target="_blank">Ver ahora</a>` : ''}
      </div>`;
    contentEl.appendChild(card);
  });
}

document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click', e=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    renderItems(tab.dataset.filter);
  });
});

searchInput.addEventListener('input', applySearch);

fetch(SHEET_JSON_URL)
  .then(r=>r.json())
  .then(data=>{
    items = data;
    renderItems('all');
  });
</script>
</body>
</html>
