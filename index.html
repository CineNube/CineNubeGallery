<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CineNube Gallery</title>
<link rel="stylesheet" href="style.css">
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: #f5f5f5; margin:0; padding:0;}
  header { text-align:center; padding: 20px 0; background:#1f1f1f; }
  header h1 { margin:0; font-size:2rem; color:#00bfa5; }
  #search { width:80%; max-width:500px; padding:10px; margin:10px auto; display:block; border-radius:5px; border:none;}
  .tabs { text-align:center; margin:20px 0; }
  .tab { display:inline-block; padding:10px 20px; margin:0 5px; cursor:pointer; background:#1f1f1f; border-radius:5px; color:#f5f5f5; }
  .tab.active { background:#00bfa5; color:#121212; font-weight:bold; }
  .grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:20px; padding:20px; }
  .card { background:#1f1f1f; border-radius:10px; overflow:hidden; display:flex; flex-direction:column; }
  .card img { width:100%; height:330px; object-fit:cover; }
  .card-content { padding:10px; flex:1; display:flex; flex-direction:column; }
  .card-title { font-weight:bold; font-size:1.1rem; margin-bottom:5px; }
  .card-overview { flex:1; font-size:0.9rem; margin-bottom:5px; }
  .card-overview::after { content:"..."; }
  .card-meta { font-size:0.85rem; margin-bottom:5px; }
  .seasons { margin-top:5px; display:flex; flex-wrap:wrap; gap:5px; }
  .season-btn { background:#00bfa5; color:#121212; padding:5px 10px; border-radius:5px; text-decoration:none; font-size:0.8rem; }
  .votes { display:flex; gap:10px; font-size:0.9rem; margin-top:5px; }
  .up { color:#4caf50; }
  .down { color:#f44336; }
</style>
</head>
<body>
<header>
  <h1>CineNube Gallery</h1>
</header>
<input type="text" id="search" placeholder="Buscar...">
<div class="tabs">
  <span class="tab active" data-type="all">Todo</span>
  <span class="tab" data-type="movie">Pel√≠culas</span>
  <span class="tab" data-type="series">Series</span>
</div>
<div class="grid" id="grid"></div>

<script>
const SHEET_JSON_URL = "https://script.google.com/macros/s/AKfycbx1Vq5HqmPMExtgm1PRgct2WRzGex5BTEtDERIKHA20VZNFf-umdHpiKD94Df80S2vO1g/exec";
let items = [];

function truncate(text, maxLength=120){
  if(!text) return "";
  return text.length>maxLength ? text.slice(0,maxLength) + "..." : text;
}

function renderCards(type='all',filterText=''){
  const grid = document.getElementById('grid');
  grid.innerHTML='';
  let filtered = items;
  if(type!=='all') filtered = filtered.filter(i=>i.type===type);
  if(filterText) filtered = filtered.filter(i=>i.title.toLowerCase().includes(filterText.toLowerCase()));
  // Orden descendente por published_ts
  filtered.sort((a,b)=>b.published_ts - a.published_ts);
  
  filtered.forEach(i=>{
    let card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <img src="${i.poster}" alt="${i.title}">
      <div class="card-content">
        <div class="card-title">${i.title}</div>
        <div class="card-overview">${truncate(i.overview)}</div>
        <div class="card-meta">‚≠ê ${i.rating || 'N/A'} | üìÖ ${i.year || ''}</div>
        <div class="votes">
          <span class="up">üëç ${i.vote_count && i.vote_average ? Math.round(i.vote_count*(i.vote_average/10)) : 0}</span>
          <span class="down">üëé ${i.vote_count && i.vote_average ? i.vote_count-Math.round(i.vote_count*(i.vote_average/10)) : 0}</span>
        </div>
        <div class="seasons">
          ${i.season_links && i.season_links.length>0 ? i.season_links.map(s=>s.link?`<a href="${s.link}" target="_blank" class="season-btn">Temporada ${s.season}</a>`:'').join('') : ''}
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}

fetch(SHEET_JSON_URL)
  .then(res=>res.json())
  .then(data=>{ items=data; renderCards(); });

document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    renderCards(tab.dataset.type,document.getElementById('search').value);
  });
});

document.getElementById('search').addEventListener('input',(e)=>{
  const active = document.querySelector('.tab.active').dataset.type;
  renderCards(active,e.target.value);
});
</script>
</body>
</html>
