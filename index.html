<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CineNube Gallery</title>
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;background:#0e0e0e;color:#fff;margin:0;padding:0;overflow-x:hidden}
  header{background:#1c1c1c;padding:18px;text-align:center;font-size:24px;font-weight:700;color:#00aaff;box-shadow:0 0 8px rgba(0,0,0,.5)}
  nav{display:flex;justify-content:center;gap:14px;background:#141414;padding:10px 8px;font-weight:700;flex-wrap:wrap}
  nav button{background:none;border:1px solid transparent;color:#fff;cursor:pointer;font-size:15px;padding:6px 10px;border-radius:6px;transition:all .18s}
  nav button.active{border-color:rgba(0,170,255,.18);background:rgba(0,170,255,.03);color:#00aaff}
  nav button:hover{color:#00aaff}
  #gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;padding:18px}
  .item{background:#141414;border-radius:12px;overflow:hidden;text-align:left;box-shadow:0 0 10px rgba(0,0,0,0.6);transition:transform .18s,box-shadow .18s;position:relative;display:flex;flex-direction:column;height:480px}
  .item:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,170,255,.08)}
  .thumb{height:300px;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block;border-bottom:3px solid #00aaff}
  .content{padding:10px 12px;display:flex;flex-direction:column;flex:1}
  .title{color:#00aaff;font-size:16px;margin:6px 0 4px;height:40px;overflow:hidden}
  .overview{font-size:13px;color:#ccc;line-height:1.2;height:66px;overflow:hidden;margin-bottom:8px}
  .meta{font-size:12px;color:#99e6ff;margin-bottom:8px}
  .btn{margin-top:auto;display:block;background:#00aaff;color:#fff;text-decoration:none;padding:10px;border-radius:8px;font-weight:700;text-align:center}
  .tag{position:absolute;top:12px;left:12px;background:#00aaff;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:700}
  .new{position:absolute;top:12px;right:12px;background:#ff2d55;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:700}
  .social-share{display:flex;justify-content:center;gap:8px;margin-top:8px}
  .social-btn{border:none;background:#222;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.2s}
  .social-btn:hover{background:#00aaff}
  .social-btn img{width:18px;height:18px}
  @media(max-width:700px){.item{height:auto}.thumb{height:260px}}
</style>
</head>
<body>
<header>üé¨ CineNube Gallery</header>
<nav id="nav">
  <button data-filter="all" class="active">üîÅ Todos</button>
  <button data-filter="recientes">üî• Recientes (24h)</button>
  <button data-filter="movie">üé• Pel√≠culas</button>
  <button data-filter="series">üì∫ Series</button>
</nav>

<div id="gallery"></div>

<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';

function safeParseJSON(s){ try{ return JSON.parse(s); }catch(e){ return null; } }
function escapeHtml(s){ return s?String(s).replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])):''; }
function parseDatePrefer(o){const c=[o.published_at,o.updated,o.year];for(const x of c){if(!x)continue;const t=Date.parse(x);if(!isNaN(t))return t;}return null;}
function normalizeLink(raw){if(!raw)return'#';const s=String(raw).trim();if(s.startsWith('http'))return s;return'https://cinenube.github.io/CineNubeGallery/'+s.replace(/^\/+/,'');}

async function load(){
  const r=await fetch(SHEET_URL);const d=await r.json();if(!Array.isArray(d))return;
  const list=d.map(x=>({title:x.title||x.titulo||x.name||'',poster:x.poster||x.imagen||'',overview:x.overview||x.descripcion||'',rating:x.rating||'',year:x.year||'',type:(x.type||x.tipo||'movie').toLowerCase(),terabox:x.terabox||'',season_links:x.season_links||'',_ts:parseDatePrefer(x)}));
  list.sort((a,b)=>(b._ts||0)-(a._ts||0));
  render(list);
}

function getPrimaryLink(it){
  if(it.terabox){try{const p=safeParseJSON(it.terabox);if(Array.isArray(p)&&p[0]&&p[0].link)return p[0].link;}catch{}const m=(it.terabox||'').match(/https?:\/\/[^\s"']+/);if(m)return m[0];}
  if(it.season_links){try{const s=safeParseJSON(it.season_links);if(Array.isArray(s)&&s[0]&&s[0].link)return s[0].link;}catch{}}
  return '#';
}

function shareContent(platform,title,url){
  const text=`üé¨ ${title}\nM√≠ralo aqu√≠ üëâ ${url}`;
  if(platform==='whatsapp') window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,'_blank');
  if(platform==='x') window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(text)}`,'_blank');
  if(platform==='facebook') window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(title)}`,'_blank');
  if(platform==='copy'){navigator.clipboard.writeText(text);alert('üìã Enlace copiado al portapapeles');}
}

function render(list){
  const g=document.getElementById('gallery');g.innerHTML='';
  list.forEach(it=>{
    const poster=(it.poster.startsWith('http')?it.poster:'https://image.tmdb.org/t/p/w500'+it.poster);
    const link=normalizeLink(getPrimaryLink(it));
    const tipo=it.type.includes('serie')?'üì∫ Serie':'üé• Pel√≠cula';
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`
      <div class="thumb"><img src="${poster}" alt="${escapeHtml(it.title)}"></div>
      <div class="content">
        <div class="title">${escapeHtml(it.title)}</div>
        <div class="overview">${escapeHtml(it.overview).slice(0,120)}...</div>
        <div class="meta">${it.rating?'‚≠ê '+it.rating:''} ${it.year?'‚Ä¢ '+it.year:''}</div>
        <a class="btn" href="${link}" target="_blank">${tipo.includes('Serie')?'üì∫ Ver temporada':'üé¨ Ver pel√≠cula'}</a>
        <div class="social-share">
          <button class="social-btn" onclick="shareContent('whatsapp','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg"></button>
          <button class="social-btn" onclick="shareContent('x','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg"></button>
          <button class="social-btn" onclick="shareContent('facebook','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg"></button>
          <button class="social-btn" onclick="shareContent('copy','${escapeHtml(it.title)}','${link}')"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/link.svg"></button>
        </div>
      </div>
      <span class="tag">${tipo}</span>`;
    g.appendChild(div);
  });
}
load();
</script>
</body>
</html>
