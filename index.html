<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CineNube Gallery</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#121212; color:#fff; }
  header { background:#1f1f1f; padding:10px 20px; display:flex; align-items:center; justify-content:space-between; }
  header h1 { margin:0; font-size:1.5em; color:#ff3d00; }
  #searchInput { padding:5px 10px; width:200px; border-radius:5px; border:none; }
  nav { margin:10px 20px; }
  nav button { background:#2c2c2c; color:#fff; border:none; padding:8px 15px; margin-right:5px; cursor:pointer; border-radius:5px; }
  nav button.active { background:#ff3d00; }
  main { display:flex; flex-wrap:wrap; justify-content:center; margin:10px; }
  .item-card { background:#1f1f1f; border-radius:8px; margin:10px; width:180px; overflow:hidden; display:flex; flex-direction:column; }
  .item-card img { width:100%; height:270px; object-fit:cover; }
  .item-info { padding:10px; flex:1; display:flex; flex-direction:column; justify-content:space-between; }
  .item-title { font-weight:bold; font-size:1em; margin-bottom:5px; }
  .item-overview { font-size:0.85em; color:#ccc; flex:1; margin-bottom:5px; overflow:hidden; display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical; }
  .item-meta { font-size:0.8em; color:#aaa; margin-bottom:5px; }
  .season-buttons a, .movie-button a { display:block; background:#ff3d00; color:#fff; text-decoration:none; text-align:center; margin-top:3px; padding:5px; border-radius:5px; font-size:0.85em; }
</style>
</head>
<body>

<header>
  <h1>CineNube Gallery</h1>
  <input type="text" id="searchInput" placeholder="Buscar...">
</header>

<nav>
  <button class="filter-btn active" data-filter="all">Todo</button>
  <button class="filter-btn" data-filter="movie">Pel√≠culas</button>
  <button class="filter-btn" data-filter="series">Series</button>
</nav>

<main id="itemsContainer"></main>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbx1Vq5HqmPMExtgm1PRgct2WRzGex5BTEtDERIKHA20VZNFf-umdHpiKD94Df80S2vO1g/exec";

let allItems = [];

async function fetchItems() {
  try {
    const res = await fetch(WEBAPP_URL);
    const data = await res.json();
    allItems = data.sort((a,b)=>b.published_ts - a.published_ts);
    renderItems(allItems);
  } catch(err) {
    console.error("Error al cargar items:", err);
    document.getElementById('itemsContainer').innerHTML = '<p style="color:red;">No se pudo cargar el contenido.</p>';
  }
}

function renderItems(items){
  const container = document.getElementById('itemsContainer');
  container.innerHTML = '';
  items.forEach(item=>{
    const card = document.createElement('div');
    card.className = 'item-card';
    card.innerHTML = `
      <img src="${item.poster||'https://via.placeholder.com/180x270?text=No+Image'}" alt="${item.title}">
      <div class="item-info">
        <div class="item-title">${item.title}</div>
        <div class="item-overview">${item.overview}</div>
        <div class="item-meta">‚≠ê ${item.rating||'N/A'} | üìÖ ${item.year||'N/A'}</div>
        <div class="season-buttons">
          ${item.type==='series' && item.season_links?.length
            ? item.season_links.map(s=>s.link?`<a href="${s.link}" target="_blank">Temporada ${s.season}</a>`:'').join('') : ''}
        </div>
        <div class="movie-button">
          ${item.type==='movie' && item.terabox ? `<a href="${item.terabox}" target="_blank">Ver ahora</a>` : ''}
        </div>
      </div>
    `;
    container.appendChild(card);
  });
}

// Filtros
document.querySelectorAll('.filter-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const filter = btn.dataset.filter;
    renderItems(filter==='all'?allItems:allItems.filter(i=>i.type===filter));
  });
});

// Buscar
document.getElementById('searchInput').addEventListener('input', e=>{
  const query = e.target.value.toLowerCase();
  const filterBtn = document.querySelector('.filter-btn.active').dataset.filter;
  const filtered = allItems.filter(i=>{
    const matchFilter = filterBtn==='all'||i.type===filterBtn;
    return matchFilter && i.title.toLowerCase().includes(query);
  });
  renderItems(filtered);
});

fetchItems();
</script>

</body>
</html>
