<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="CineNube Gallery - Pel√≠culas y series con enlaces actualizados.">
<title>üé¨ CineNube Gallery</title>
<link rel="icon" href="https://cinenube.github.io/CineNubeGallery/favicon.png" type="image/png">
<style>
body { font-family: Arial, sans-serif; background-color: #0e0e0e; color: #fff; margin: 0; padding: 0; }
header { text-align: center; background-color: #141414; padding: 20px 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
h1 { font-size: 2em; color: #ff4444; margin-bottom: 10px; }
nav { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
nav button { background: #ff4444; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; transition: 0.3s; }
nav button:hover { background: #ff6666; }
.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; }
.card { background: #1c1c1c; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.3); transition: transform 0.3s; }
.card:hover { transform: scale(1.03); }
.poster { width: 100%; height: 300px; object-fit: cover; }
.content { padding: 10px; }
.title { font-size: 1.1em; font-weight: bold; margin: 5px 0; color: #ff4444; }
.desc { color: #ccc; font-size: 0.9em; margin-top: 5px; height: 60px; overflow: hidden; }
.hashtags { font-size: 12px; color: #00ccff; margin-top: 5px; overflow: hidden; height: 36px; }
.link { display: block; background: #ff4444; color: white; text-align: center; padding: 8px; margin-top: 10px; border-radius: 5px; font-weight: bold; text-decoration: none; }
.link:hover { background: #ff6666; }
footer { text-align: center; padding: 20px; background: #141414; color: #aaa; font-size: 0.9em; }
</style>
</head>
<body>
<header>
<h1>üé¨ CineNube Gallery</h1>
<nav>
<button onclick="filterContent('all')">üî• Todo</button>
<button onclick="filterContent('movie')">üé• Pel√≠culas</button>
<button onclick="filterContent('series')">üì∫ Series</button>
</nav>
</header>

<div id="catalog" class="grid"></div>

<footer>‚¨ÖÔ∏è Volver al inicio: <a href="index.html">CineNube Gallery</a></footer>

<script>
const sheetURL = 'https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';
let allData = [];

async function loadCatalog() {
  try {
    const res = await fetch(sheetURL);
    const data = await res.json();

    // Filtrar solo movies y series y ordenar por published_at m√°s reciente
    allData = data.filter(x => x.type && (x.type.toLowerCase() === 'movie' || x.type.toLowerCase() === 'series'))
                  .sort((a,b) => new Date(b.published_at) - new Date(a.published_at));

    renderCatalog(allData);
  } catch(e) {
    document.getElementById('catalog').innerHTML = '<p style="text-align:center;color:#ccc;">Error cargando datos</p>';
    console.error('Error:', e);
  }
}

function renderCatalog(items) {
  const catalog = document.getElementById('catalog');
  catalog.innerHTML = '';

  items.forEach(item => {
    const tipo = (item.type || '').toLowerCase();
    const tipoTexto = tipo === 'series' ? 'üì∫ Serie' : 'üé• Pel√≠cula';

    // Obtener link
    let link = '#';
    if(item.terabox && item.terabox.includes('http')) {
      try { link = JSON.parse(item.terabox)[0]?.link || item.terabox; } catch{} 
    } else if(item.season_links) {
      try { link = JSON.parse(item.season_links)[0]?.link || '#'; } catch{} 
    }

    // Hashtags
    let hashtags = '';
    if(item.generos) {
      const arr = item.generos.split(',').map(g => '#' + g.trim().replace(/\s+/g,''));
      hashtags = arr.join(' ');
    }

    const card = document.createElement('div');
    card.classList.add('card');
    card.dataset.type = tipo;
    card.innerHTML = `
      <img src="${item.poster || ''}" alt="${item.title || 'Sin t√≠tulo'}" class="poster">
      <div class="content">
        <div class="title">${item.title || 'Sin t√≠tulo'}</div>
        <div class="desc">${item.overview || 'Sin descripci√≥n'}</div>
        <div class="hashtags">${hashtags}</div>
        <a href="${link}" target="_blank" class="link">Ver / Descargar</a>
      </div>`;
    catalog.appendChild(card);
  });
}

function filterContent(type) {
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
    card.style.display = (type === 'all' || card.dataset.type === type) ? 'block' : 'none';
  });
}

loadCatalog();
</script>
</body>
</html>
