<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CineNube Gallery</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<style>
body { background-color: #0d0d0d; color: #fff; font-family: 'Poppins', sans-serif; }
header { text-align: center; padding: 1.5rem 0; }
section { margin: 2rem auto; max-width: 1200px; }
h2 { border-left: 4px solid #e50914; padding-left: 10px; margin-bottom: 1rem; }
.card { background-color: #1a1a1a; border: none; border-radius: 10px; overflow: hidden; transition: transform 0.3s ease; }
.card:hover { transform: scale(1.03); }
.card img { width: 100%; height: 330px; object-fit: cover; }
.card-body { padding: 0.8rem; }
.card-title { font-size: 1rem; font-weight: 600; }
.btn-ver { background-color: #e50914; color: #fff; border: none; border-radius: 20px; padding: 6px 12px; text-decoration: none; display: inline-block; margin: 2px; }
footer { text-align: center; padding: 2rem; color: #aaa; }
</style>
</head>
<body>
<header>
  <h1>ğŸ¬ CineNube Gallery</h1>
</header>

<section>
  <h2>ğŸ”¥ Recientes</h2>
  <div id="recientes" class="row g-3"></div>
</section>

<section>
  <h2>ğŸ¥ PelÃ­culas</h2>
  <div id="peliculas" class="row g-3"></div>
</section>

<section>
  <h2>ğŸ“º Series</h2>
  <div id="series" class="row g-3"></div>
</section>

<footer>Â© 2025 CineNube Gallery</footer>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec";

async function cargarDatos() {
  try {
    const res = await fetch(SHEET_URL);
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error("Datos no vÃ¡lidos");

    // Ordenar de mÃ¡s reciente a mÃ¡s antiguo
    const ordenado = data.sort((a, b) => {
      const fechaA = new Date(a.fecha || a.date || 0);
      const fechaB = new Date(b.fecha || b.date || 0);
      return fechaB - fechaA;
    });

    // Filtrar categorÃ­as
    const peliculas = ordenado.filter(i =>
      (i.type || "").toLowerCase().includes("pel")
    );
    const series = ordenado.filter(i =>
      (i.type || "").toLowerCase().includes("ser")
    );

    mostrar(ordenado.slice(0, 8), "recientes");
    mostrar(peliculas, "peliculas");
    mostrar(series, "series");

  } catch (e) {
    console.error("Error:", e);
  }
}

function corregirEnlace(url) {
  if (!url) return "#";
  if (url.startsWith("http")) return url;
  return "https://cinenube.github.io/CineNubeGallery/" + url.replace(/^\/+/, "");
}

function mostrar(lista, contenedorId) {
  const contenedor = document.getElementById(contenedorId);
  contenedor.innerHTML = "";

  lista.forEach(item => {
    const img = item.poster?.startsWith("http")
      ? item.poster
      : `https://image.tmdb.org/t/p/w500${item.poster}`;

    let botones = "";

    // ğŸ¥ PelÃ­culas â†’ usar terabox
    if (item.terabox) {
      const enlace = corregirEnlace(item.terabox);
      botones += `<a href="${enlace}" target="_blank" class="btn-ver">ğŸ¬ Ver pelÃ­cula</a>`;
    }

    // ğŸ“º Series â†’ usar season_links (JSON)
    if (item.season_links) {
      try {
        const temporadas = JSON.parse(item.season_links);
        temporadas.forEach(temp => {
          if (temp.link) {
            const link = corregirEnlace(temp.link);
            botones += `<a href="${link}" target="_blank" class="btn-ver">ğŸ“º T${temp.season}</a>`;
          }
        });
      } catch (err) {
        console.warn("Error leyendo season_links:", err);
      }
    }

    const card = `
      <div class="col-6 col-md-3">
        <div class="card">
          <img src="${img}" alt="${item.title}">
          <div class="card-body">
            <h5 class="card-title">${item.title || "Sin tÃ­tulo"}</h5>
            <p>â­ï¸ ${item.rating || "N/A"} | ğŸ“… ${item.year || ""}</p>
            ${botones}
          </div>
        </div>
      </div>`;
    contenedor.innerHTML += card;
  });
}

cargarDatos();
</script>
</body>
</html>
