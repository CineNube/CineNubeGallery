<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CineNube</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #eee; margin: 0; padding: 0; min-height:100vh; }
  header { text-align: center; padding: 2rem; background: linear-gradient(135deg, #111, #222); box-shadow: 0 2px 10px #000; }
  h1 { margin: 0; font-size: 2.5rem; color: #ff6600; letter-spacing: 1px; }
  nav { text-align: center; margin: 1rem 0; }
  nav button { margin: 0.4rem; padding: 0.6rem 1.2rem; cursor: pointer; background: #333; color: #eee; border: none; border-radius: 8px; font-weight: bold; transition: 0.3s; }
  nav button:hover { background: #ff6600; color: #111; }
  nav button.active { background: #ff6600; color: #111; }

  #searchBox { display:block; margin: 0 auto 1.5rem auto; padding: 0.6rem 1rem; width: 80%; max-width:400px; border-radius: 8px; border:none; font-size:1rem; }

  section { display: flex; flex-wrap: wrap; justify-content: center; padding: 1rem; min-height: 60vh; gap: 1rem; }
  .item { background: #1b1b1b; border-radius: 10px; width: 210px; text-align: center; box-shadow: 0 0 10px #000; transition: transform 0.2s, box-shadow 0.2s; overflow: hidden; }
  .item:hover { transform: scale(1.04); box-shadow: 0 0 20px #ff660055; }
  .item img { width: 100%; height: 310px; object-fit: cover; display:block; border-bottom: 2px solid #333; }
  .item h3 { margin: 0.6rem 0; font-size: 1.05rem; color:#ff6600; }
  .item .meta { font-size: 0.85rem; color: #bbb; margin-bottom: 0.5rem; }
  .item a { display: inline-block; margin: 0.3rem; padding: 0.4rem 0.6rem; background: #ff6600; color: #111; text-decoration: none; border-radius: 5px; font-weight: 600; transition: 0.2s; }
  .item a:hover { background: #ffa347; }
  .small-link { background: #444; color: #eee; padding: 0.25rem 0.4rem; border-radius: 4px; font-size:0.85rem;}
  .hidden { display: none; }
  .message { text-align: center; color: #888; padding: 2rem; width:100%; }
</style>
</head>
<body>

<header>
  <h1>CineNube</h1>
</header>

<nav>
  <button data-filter="movies" class="active">Pel√≠culas</button>
  <button data-filter="series">Series</button>
  <button data-filter="recent">Recientes</button>
</nav>

<input id="searchBox" type="text" placeholder="üîç Buscar pel√≠culas o series..."/>

<section id="gallery">
  <p class="message">Cargando cat√°logo‚Ä¶</p>
</section>

<script>
const gallery = document.getElementById('gallery');
const searchBox = document.getElementById('searchBox');
let catalogo = [];

// Funci√≥n principal: mostrar √≠tems seg√∫n filtro
function showItems(filter, searchTerm = '') {
  gallery.innerHTML = '';
  let items = [];

  // Filtrado por tipo
  if (filter === 'movies') {
    items = catalogo.filter(i => i.type?.toLowerCase() === 'movie');
  } else if (filter === 'series') {
    items = catalogo.filter(i => i.type?.toLowerCase() === 'series');
  } else if (filter === 'recent') {
    items = [...catalogo].sort((a,b)=> new Date(b.added) - new Date(a.added));
  } else {
    items = catalogo;
  }

  // Buscador (tolerante a errores)
  if (searchTerm.trim() !== '') {
    const clean = t => t.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
    items = items.filter(i => clean(i.title||'').includes(clean(searchTerm)));
  }

  if (items.length === 0) {
    gallery.innerHTML = '<p class="message">No se encontr√≥ contenido.</p>';
    return;
  }

  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'item';

    const img = document.createElement('img');
    img.src = item.poster || 'https://via.placeholder.com/200x300?text=Sin+Imagen';
    img.alt = item.title || 'Sin t√≠tulo';
    div.appendChild(img);

    const h3 = document.createElement('h3');
    h3.textContent = item.title || 'Sin t√≠tulo';
    div.appendChild(h3);

    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.textContent = (item.year ? item.year + ' ¬∑ ' : '') + (item.type === 'movie' ? 'Pel√≠cula' : 'Serie');
    div.appendChild(meta);

    // Pel√≠culas
    if (item.type === 'movie' && item.terabox) {
      const link = document.createElement('a');
      link.href = item.terabox;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.textContent = 'Ver Pel√≠cula';
      div.appendChild(link);
    }

    // Series con temporadas
    if (item.type === 'series' && item.season_links) {
      try {
        const seasons = JSON.parse(item.season_links);
        if (Array.isArray(seasons)) {
          seasons.forEach(season => {
            if (season.link) {
              const sLink = document.createElement('a');
              sLink.href = season.link;
              sLink.target = '_blank';
              sLink.rel = 'noopener noreferrer';
              sLink.textContent = `Temporada ${season.season}`;
              sLink.className = 'small-link';
              div.appendChild(sLink);
            }
          });
        }
      } catch (err) {
        console.error('Error parseando season_links:', err, item.season_links);
      }
    }

    gallery.appendChild(div);
  });
}

// Filtros de navegaci√≥n
const buttons = document.querySelectorAll('nav button');
buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    buttons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    showItems(btn.dataset.filter, searchBox.value);
  });
});

// Buscador
searchBox.addEventListener('input', e => {
  const active = document.querySelector('nav button.active').dataset.filter;
  showItems(active, e.target.value);
});

// Cargar desde tu hoja de Google Sheets (Sheet.best)
fetch('https://api.sheetbest.com/sheets/4b4d9aed-b6a1-414d-a2d4-5c7605b85501')
  .then(r => r.json())
  .then(data => {
    catalogo = data;
    console.log('‚úÖ Cat√°logo cargado:', catalogo);
    showItems('movies');
  })
  .catch(err => {
    console.error('‚ùå Error al cargar el cat√°logo:', err);
    gallery.innerHTML = '<p class="message" style="color:tomato;">Error al cargar el cat√°logo.</p>';
  });
</script>

</body>
</html>
