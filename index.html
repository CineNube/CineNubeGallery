<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¬ CineNube Gallery</title>
<style>
body{font-family:'Segoe UI',Arial,sans-serif;background:#0e0e0e;color:#fff;margin:0;padding:0;overflow-x:hidden}
header{background:#1c1c1c;padding:20px;text-align:center;font-size:26px;font-weight:bold;color:#00aaff;box-shadow:0 0 10px rgba(0,0,0,0.5)}
nav{display:flex;justify-content:center;gap:20px;background:#141414;padding:12px 0;font-weight:bold}
nav button{background:none;border:none;color:#fff;cursor:pointer;font-size:16px;transition:color .3s}
nav button:hover{color:#00aaff}
#gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;padding:20px}
.item{background:#1a1a1a;border-radius:12px;overflow:hidden;text-align:center;box-shadow:0 0 10px rgba(0,0,0,0.5);transition:transform .25s,box-shadow .25s;position:relative}
.item:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(0,170,255,.6)}
.item img{width:100%;height:320px;object-fit:cover;border-bottom:3px solid #00aaff}
@media(max-width:768px){.item img{height:260px}}
.tag{position:absolute;top:10px;left:10px;background:#00aaff;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:bold}
.new{position:absolute;top:10px;right:10px;background:#ff2d55;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:bold;animation:pulse 1.5s infinite}
@keyframes pulse{0%{opacity:1}50%{opacity:.6}100%{opacity:1}}
.item h3{font-size:17px;margin:10px 0 5px;color:#00aaff}
.item p{font-size:13px;color:#ccc;padding:0 10px;text-align:justify;height:60px;overflow:hidden}
.hashtags{font-size:12px;color:#00ccff;margin:5px 0 10px;padding:0 10px;height:36px;overflow:hidden}
.btn{display:block;background:#00aaff;color:#fff;text-decoration:none;padding:10px;border-radius:0 0 12px 12px;font-weight:bold;transition:background .3s}
.btn:hover{background:#0077cc}
</style>
</head>
<body>
<header>ðŸŽ¬ CineNube Gallery</header>
<nav>
  <button onclick="filterContent('recientes')">ðŸ”¥ Recientes</button>
  <button onclick="filterContent('pelicula')">ðŸŽ¥ PelÃ­culas</button>
  <button onclick="filterContent('serie')">ðŸ“º Series</button>
</nav>
<div id="gallery"></div>
<script>
const SHEET_URL='https://script.google.com/macros/s/AKfycbz0AxlhwQ5-8hnnRMnhP8S-i0xQoUg3iWoEYXbT5o_ltCpR7mAIZqPaHqccFzkC34cLbw/exec';
let allData=[];

async function loadGallery(){
  try{
    const res = await fetch(SHEET_URL);
    const data = await res.json();
    allData = data.map(item => ({...item, published_at_parsed: new Date(item.published_at)}))
                  .sort((a,b)=>b.published_at_parsed - a.published_at_parsed);
    renderGallery(allData);
  }catch(e){
    document.getElementById('gallery').innerHTML='<p style="text-align:center;color:#ccc;">Error cargando datos</p>';
    console.error(e);
  }
}

function renderGallery(items){
  const g=document.getElementById('gallery'); g.innerHTML='';
  const now=Date.now();
  items.forEach(item=>{
    const tipo=(item.type||'pelicula').toLowerCase();
    const tipoTexto=tipo==='serie'?'ðŸ“º Serie':'ðŸŽ¥ PelÃ­cula';
    const btnText=tipo==='serie'?'ðŸ“º Ver temporada':'ðŸŽ¥ Ver pelÃ­cula';
    let link='#';
    if(item.terabox && item.terabox.includes('http')) link=item.terabox;
    else if(item.season_links){
      try{const s=JSON.parse(item.season_links);link=s[0]?.link||'#';}catch{}
    }
    let hashtags='';
    if(item.generos){hashtags=item.generos.split(',').map(g=>'#'+g.trim().replace(/\s+/g,'')).join(' ');}
    const isNew=(now-item.published_at_parsed.getTime())/(1000*3600*24)<=2;

    const div=document.createElement('div');
    div.className='item';
    div.dataset.type=tipo;
    div.innerHTML=`
      <span class="tag">${tipoTexto}</span>
      ${isNew?'<span class="new">ðŸ†• Nuevo</span>':''}
      <img src="${item.poster}" loading="lazy" alt="${item.title}">
      <h3>${item.title}</h3>
      <p>${item.overview||''}</p>
      <div class="hashtags">${hashtags}</div>
      <a href="${link}" target="_blank" class="btn">${btnText}</a>`;
    g.appendChild(div);
  });
}

function filterContent(type){
  const now=Date.now();
  if(type==='recientes'){
    const recientes=allData.filter(x=>(now-x.published_at_parsed.getTime())/86400000<=2);
    renderGallery(recientes);
  }else{
    renderGallery(allData.filter(x=>(x.type||'').toLowerCase()===type));
  }
}

loadGallery();
</script>
</body>
</html>
