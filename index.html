<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CineNube Catalogo</title>
<style>
  body { font-family: Arial, sans-serif; background: #0f0f0f; color: #fff; margin: 0; padding: 0;}
  header { padding: 10px 20px; background: #1c1c1c; display: flex; justify-content: space-between; align-items: center;}
  header h1 { margin: 0; font-size: 1.8rem; color: #ff3c3c;}
  #searchBar { padding: 5px 10px; font-size: 1rem; width: 200px; border-radius: 5px; border: none;}
  #filters { margin-top: 10px; display: flex; gap: 10px; justify-content: center;}
  #filters button { padding: 8px 15px; border: none; border-radius: 5px; background: #333; color: #fff; cursor: pointer;}
  #filters button.active { background: #ff3c3c;}
  #catalog { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 15px; padding: 20px;}
  .card { background: #1c1c1c; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; }
  .card img { width: 100%; object-fit: cover; height: 300px; }
  .card-content { padding: 10px; flex: 1; display: flex; flex-direction: column; }
  .card h2 { margin: 0; font-size: 1.1rem; color: #ff3c3c; }
  .card p { font-size: 0.9rem; flex: 1; margin: 5px 0; }
  .rating-year { font-size: 0.85rem; margin-bottom: 5px; color: #aaa; }
  .buttons { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
  .buttons a { text-decoration: none; background: #ff3c3c; color: #fff; padding: 5px 8px; border-radius: 5px; font-size: 0.85rem; }
  @media(max-width:500px){ .card img{height:200px;} }
</style>
</head>
<body>

<header>
  <h1>CineNube</h1>
  <input type="text" id="searchBar" placeholder="Buscar...">
</header>

<div id="filters">
  <button data-filter="all" class="active">Todas</button>
  <button data-filter="movie">Películas</button>
  <button data-filter="series">Series</button>
</div>

<div id="catalog"></div>

<script>
const SHEET_JSON_URL = "https://script.google.com/macros/s/AKfycbx1Vq5HqmPMExtgm1PRgct2WRzGex5BTEtDERIKHA20VZNFf-umdHpiKD94Df80S2vO1g/exec";

let catalogData = [];
let currentFilter = 'all';

async function fetchCatalog() {
  try {
    const res = await fetch(SHEET_JSON_URL);
    const data = await res.json();
    catalogData = data.map(item => {
      // Filtrar seasons con link válido
      if(item.season_links && Array.isArray(item.season_links)){
        item.season_links = item.season_links.filter(s=>s.link && s.link.includes('terabox'));
      } else {
        item.season_links = [];
      }
      return item;
    });
    renderCatalog();
  } catch (err) {
    console.error("Error cargando catalogo:", err);
  }
}

function renderCatalog() {
  const container = document.getElementById('catalog');
  container.innerHTML = '';

  const filtered = catalogData.filter(item => {
    if(currentFilter==='all') return true;
    return item.type===currentFilter;
  });

  filtered.forEach(item => {
    const card = document.createElement('div');
    card.classList.add('card');

    const img = document.createElement('img');
    img.src = item.poster || 'https://via.placeholder.com/300x450?text=Sin+Imagen';
    card.appendChild(img);

    const content = document.createElement('div');
    content.classList.add('card-content');

    const title = document.createElement('h2');
    title.textContent = item.title;
    content.appendChild(title);

    const ratingYear = document.createElement('div');
    ratingYear.classList.add('rating-year');
    ratingYear.textContent = `⭐ ${item.rating || 'N/A'} | ${item.year || 'N/A'}`;
    content.appendChild(ratingYear);

    const overview = document.createElement('p');
    overview.textContent = item.overview || '';
    content.appendChild(overview);

    // Botones de temporadas (series)
    if(item.type==='series' && item.season_links.length>0){
      const btnContainer = document.createElement('div');
      btnContainer.classList.add('buttons');
      item.season_links.forEach(s=>{
        const btn = document.createElement('a');
        btn.href = s.link;
        btn.target = '_blank';
        btn.textContent = `Temporada ${s.season}`;
        btnContainer.appendChild(btn);
      });
      content.appendChild(btnContainer);
    }

    // Botón de ver película (películas)
    if(item.type==='movie' && item.terabox && item.terabox.includes('http')){
      const btnMovie = document.createElement('div');
      btnMovie.classList.add('buttons');
      const a = document.createElement('a');
      a.href = item.terabox;
      a.target = '_blank';
      a.textContent = 'Ver ahora';
      btnMovie.appendChild(a);
      content.appendChild(btnMovie);
    }

    card.appendChild(content);
    container.appendChild(card);
  });
}

// Filtros
document.querySelectorAll('#filters button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    currentFilter = btn.dataset.filter;
    document.querySelectorAll('#filters button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    renderCatalog();
  });
});

// Búsqueda
document.getElementById('searchBar').addEventListener('input', e=>{
  const query = e.target.value.toLowerCase();
  catalogData.forEach(item=>{
    item.visible = !query || item.title.toLowerCase().includes(query) || (item.overview && item.overview.toLowerCase().includes(query));
  });
  renderCatalog();
});

// Inicializar
fetchCatalog();
</script>

</body>
</html>
